import{getAuth,signOut,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";import{app}from"./fbmanifeswebpack.min.js";const auth=getAuth(app);const INACTIVITY_TIMEOUT=3600000;const LAST_ACTIVITY_KEY='activity';export async function forceLogout(){try{await signOut(auth);localStorage.clear();sessionStorage.clear();location.href='../../'}catch(err){console.error("Error en logout:",err);localStorage.clear();location.href='../../'}}function checkInactivity(){const lastActivityTime=localStorage.getItem(LAST_ACTIVITY_KEY);const currentTime=(new Date).getTime();if(lastActivityTime&&(currentTime-parseInt(lastActivityTime))>INACTIVITY_TIMEOUT){alert('Tu sesión ha expirado por inactividad. Por favor, vuelve a iniciar sesión.');forceLogout()}}function setupAuthListener(){onAuthStateChanged(auth,user=>{if(!user){forceLogout()}})}const activityEvents=['mousemove','keydown','click','scroll','touchstart'];function setupActivityListeners(){activityEvents.forEach(e=>{window.addEventListener(e,()=>{localStorage.setItem(LAST_ACTIVITY_KEY,Date.now())},{passive:!0})})}document.addEventListener('DOMContentLoaded',()=>{setupActivityListeners();setupAuthListener();setInterval(checkInactivity,60000);if(!localStorage.getItem(LAST_ACTIVITY_KEY)){localStorage.setItem(LAST_ACTIVITY_KEY,Date.now())}});
