import{initializeApp}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";import{getAuth,signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";import{getFirestore,collection,getDocs,updateDoc,doc,getDoc,query,where}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";const y_={apiKey:"AIzaSyA93zj_wLvpSH_6cKRff0P2XRmya8_uoh4",authDomain:"ecuapay-c9de7.firebaseapp.com",projectId:"ecuapay-c9de7",storageBucket:"ecuapay-c9de7.firebasestorage.app",messagingSenderId:"168812396551",appId:"1:168812396551:web:100d6cfa9c425eff802aa2",measurementId:"G-1Z287M5NJY"},xc=initializeApp(y_),bb=getAuth(xc),db=getFirestore(xc);function loadPage(){document.querySelector("#code-html").innerHTML='\n        <h3>\n            BIENVENIDO A <span class="lk-home">ECUAPAY.COM</span>, LA MEJOR PASARELA DE PAGO EN LINEA DE GUINEA ECUATORIAL\n        </h3>\n        <div>   \n            <p>Acceda a su cuanta</p>    \n            <div class="container">\n                <div class="flex-container">               \n                    <div class="form">                \n                        <input class="input a" placeholder="Usuario" required="" type="text">\n                            <span class="input-border"></span>               \n                        </div>\n                        <div class="form">                \n                            <input class="input b" placeholder="Contraseña" required="" type="password">\n                            <span class="input-border"></span>             \n                        </div>\n                    </div>                 \n                </div> \n\n            <div class"err_oi"></div> \n\n            <div>\n                <input type="button" value="Acceder" id="gt">\n                <img class="d-none" src="./dist/svg/load.svg">\n            </div>\n        </div>\n    '}function vc(e,o){let r=!1,t=!1,a=!0;if(null===e||""===e.trim())erroLogin("Error (Email): El campo de correo electrónico no puede estar vacío."),a=!1;else if(e){const o=["gmail.com","icloud.com","yahoo.com","hotmail.com","outlook.com","outlook.es"];if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){const t=e.substring(e.lastIndexOf("@")+1).toLowerCase();o.includes(t)?r=!0:(erroLogin(`Error (Email): El dominio '${t}' no es uno de los dominios de correo válidos.`),a=!1)}else erroLogin("Error (Email): El formato del correo electrónico no es válido (ej. usuario@dominio.com)."),a=!1}if(r)if(null===o||""===o.trim())erroLogin("Error (Contraseña): El campo de contraseña no puede estar vacío."),a=!1;else if(o){const e=/^[A-Z]/.test(o),r=/[0-9]/.test(o);o.length<8?(erroLogin("Error (Contraseña): La contraseña debe tener al menos 8 caracteres."),a=!1):e?r?t=!0:(erroLogin("Error (Contraseña): La contraseña debe contener al menos un número."),a=!1):(erroLogin("Error (Contraseña): La contraseña debe comenzar con una letra mayúscula."),a=!1)}if(a&&r&&t)return!0}async function ccm(e,o){try{printMsgDom("info","Comprobando Credenciales...");const r=(await signInWithEmailAndPassword(bb,e,o)).user;let t,a,n;try{t=await getDocs(query(collection(db,"clients"),where("email","==",r.email)))}catch(e){printMsgDom("err",e)}t.forEach((e=>{let{email:o}=e.data();o==r.email&&(a=e.id)}));try{n=await getDoc(doc(db,"clients",a));let{uid:e}=n.data();if(e)e&&(printMsgDom("info","Dispositivo ya verificado, chequeando acceso seguro..."),sesionInfo(n.id));else{printMsgDom("info","Nuevo dispositivo detectado..");try{await updateDoc(doc(db,"clients",n.id),{uid:r.uid})}catch(e){printMsgDom("err",e)}}}catch(e){printMsgDom("err",e)}}catch(e){printMsgDom("err",e.code)}}function printMsgDom(e,o){console.log("login type=>",e," msg=>",o),"info"==e&&(document.querySelector(".errors").textContent=o),"err"==e&&("auth/invalid-credential"==o&&(document.querySelector(".errors").textContent="Correo o Contraseña invalidos"),"auth/user-disabled"==o&&(document.querySelector(".errors").textContent="Cuenta desabilitada, contacte al administrador"))}function erroLogin(e){alert(e)}async function sesionInfo(e){try{(await getDocs(query(collection(db,"cards"),where("clientId","==",e)))).forEach((e=>{localStorage.clear(),localStorage.setItem("card",e.id),localStorage.getItem("card")?location.href="../../?login=true":printMsgDom("err","Error al iniciar sesion, contacte con el administrador")}))}catch(e){return e}}loadPage(),setTimeout((()=>{document.querySelector("#gt").addEventListener("click",(()=>{let e=document.querySelector(".a").value,o=document.querySelector(".b").value;vc(e,o)&&ccm(e,o)}))}),2e3);