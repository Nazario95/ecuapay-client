import {initializeApp} from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";import {getAuth,signInWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";import {getFirestore,collection,getDocs,updateDoc,doc,getDoc,query,where}from"https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";const y_={apiKey:"AIzaSyA93zj_wLvpSH_6cKRff0P2XRmya8_uoh4",authDomain:"ecuapay-c9de7.firebaseapp.com",projectId:"ecuapay-c9de7",storageBucket:"ecuapay-c9de7.firebasestorage.app",messagingSenderId:"168812396551",appId:"1:168812396551:web:100d6cfa9c425eff802aa2",measurementId:"G-1Z287M5NJY"};const xc=initializeApp(y_);const bb=getAuth(xc);const db=getFirestore(xc);loadPage();function loadPage(){document.querySelector('#code-html').innerHTML=`<h3>BIENVENIDO A <span class="lk-home">ECUAPAY.COM</span>, LA MEJOR PASARELA DE PAGO EN LINEA DE GUINEA ECUATORIAL</h3><div><p>Acceda a su cuanta</p><div class="container"><div class="flex-container"><div class="form"><input class="input a" placeholder="Usuario" required="" type="text"><span class="input-border"></span></div><div class="form"><input class="input b" placeholder="Contraseña" required="" type="password"><span class="input-border"></span></div></div></div><div class"err_oi"></div><div><input type="button" value="Acceder" id="gt"><img class="d-none" src="./dist/svg/load.svg"></div></div>`}setTimeout(()=>{document.querySelector("#gt").addEventListener("click",()=>{let a=document.querySelector(".a").value;let b=document.querySelector(".b").value;vc(a,b)?ccm(a,b):''})},2e3);function vc(a,b){let chke=!1;let chkp=!1;let isValid=!0;if(a===null||a.trim()===''){erroLogin('Error (Email): El campo de correo electrónico no puede estar vacío.');isValid=!1}else if(a){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;const dominiosValidos=['gmail.com','icloud.com','yahoo.com','hotmail.com','outlook.com','outlook.es'];if(!emailRegex.test(a)){erroLogin("Error (Email): El formato del correo electrónico no es válido (ej. usuario@dominio.com).");isValid=!1}else{const dominio=a.substring(a.lastIndexOf('@')+1).toLowerCase();if(!dominiosValidos.includes(dominio)){erroLogin(`Error (Email): El dominio '${dominio}' no es uno de los dominios de correo válidos.`);isValid=!1}else{chke=!0}}}if(chke){if(b===null||b.trim()===''){erroLogin("Error (Contraseña): El campo de contraseña no puede estar vacío.");isValid=!1}else if(b){const tieneMayusculaInicial=/^[A-Z]/.test(b);const tieneNumero=/[0-9]/.test(b);if(b.length<8){erroLogin("Error (Contraseña): La contraseña debe tener al menos 8 caracteres.");isValid=!1}else if(!tieneMayusculaInicial){erroLogin("Error (Contraseña): La contraseña debe comenzar con una letra mayúscula.");isValid=!1}else if(!tieneNumero){erroLogin("Error (Contraseña): La contraseña debe contener al menos un número.");isValid=!1}else{chkp=!0}}}if(isValid&&chke&&chkp){return!0}}async function ccm(e,k){try{printMsgDom('info','Comprobando Credenciales...');const userCredential=await signInWithEmailAndPassword(bb,e,k);const user=userCredential.user;let resGetEmail;try{resGetEmail=await getDocs(query(collection(db,'clients'),where('email',"==",user.email)))}catch(err){printMsgDom('err',err)}let idDocClient;resGetEmail.forEach(d=>{let{email}=d.data();if(email==user.email){idDocClient=d.id}});let chckUidFromServer;try{chckUidFromServer=await getDoc(doc(db,'clients',idDocClient));let{uid}=chckUidFromServer.data();if(!uid){printMsgDom('info','Nuevo dispositivo detectado..');try{await updateDoc(doc(db,'clients',chckUidFromServer.id),{uid:user.uid})}catch(err){printMsgDom('err',err)}}else if(uid){printMsgDom('info','Dispositivo ya verificado, chequeando acceso seguro...');sesionInfo(chckUidFromServer.id)}}catch(err){printMsgDom('err',err)}}catch(err){printMsgDom('err',err.code)}}function printMsgDom(t,m){if(t=='info'){document.querySelector('.errors').textContent=m}if(t=='err'){if(m=='auth/invalid-credential'){document.querySelector('.errors').textContent='Correo o Contraseña invalidos'}if(m=='auth/user-disabled'){document.querySelector('.errors').textContent='Cuenta desabilitada, contacte al administrador'}else{document.querySelector('.errors').textContent=m}}}function erroLogin(m){alert(m)}async function sesionInfo(id){try{let res=await getDocs(query(collection(db,'cards'),where('clientId',"==",id)));res.forEach(c=>{localStorage.clear();localStorage.setItem('card',c.id);localStorage.getItem('card')?location.href='../../?login=true':printMsgDom('err','Error al iniciar sesion, contacte con el administrador')})}catch(err){return err}}
